# May 25, 2023
# Prepping new Bashbunny Mk2, or off reset.
# Commands in order.
 
apt-get clean

# setting date avoids some errors
timedatectl set-time 'YYYY-MM-DD HH:MM:SS'
timedatectl set-timezone <current-timzone>

# recoverable missing keys
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 648ACFD622F3D138 0E98404D386FA1D9

# nandf is vfat, mountable but not compatible with installing apps
# we will have to mount external storage for more space on bb
# format sdcard to fat32, we may also create two partitions
# one for storage one for a swapfile. swap fat32, storage ext4
mount /dev/mmcblk0p1 /root/sdisk
mkswap /dev/mmcblk0p5
blkid
nano /etc/fstab

# input this into fstab X's being your UUID 
# UUID=XXXXXXx-xXXXX-XXXX none swap sw,pri=5 0 0


# script for amending sources. stretch-backports is a stretch.
sources=("deb http://archive.debian.org/debian/ jessie-backports main"
"deb-src http://archive.debian.org/debian/ jessie-backports main"
"deb http://archive.debian.org/debian jessie main contrib non-free"
"deb-src http://archive.debian.org/debian jessie main contrib non-free"
"deb http://archive.debian.org/debian stretch main"
"deb-src http://archive.debian.org/debian stretch main"
"deb http://archive.debian.org/debian stretch-backports main"
"deb-src http://archive.debian.org/debian stretch-backports main")
for source in "${sources[@]}"; do
    echo "$source" | tee -a /etc/apt/sources.list
done

# getting ready for python3 and openssl
apt update && apt upgrade -y
apt install build-essential libgdbm-dev libnss3-dev libffi-dev gcc --force-yes -y

mkdir /root/sdisk
cd /root/sdisk
mkdir /root/sdisk/python3
cd /root/sdisk/python3

wget --no-check-certificate https://www.python.org/ftp/python/3.9.16/Python-3.9.16.tar.xz
tar -xvf Python-3.9.16.tar.xz
rm Python-3.9.16.tar.xz

# check unpack
cd Python-3.9.16

cd /root/sdisk/python3
mkdir openssl3_build
wget --no-check-certificate https://www.openssl.org/source/openssl-3.0.0.tar.gz
tar -xvf openssl-3.0.0.tar.gz
rm openssl-3.0.0.tar.gz
cd openssl-3.0.0

# you can check where current openssl is installed with:
find /etc/ -name openssl.cnf -printf "%h\n"

# it's /etc/ssl. this goes in --openssldir=/
./config --prefix=/root/sdisk/python3/openssl3_build --openssldir=/etc/ssl -Wl,-Bsymbolic-functions -fPIC shared

# these take a while
make
make test
make install





